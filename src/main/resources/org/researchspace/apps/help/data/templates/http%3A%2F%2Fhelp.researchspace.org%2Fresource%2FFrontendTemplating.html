<ol class="page-breadcrumb">
  <li>
    <mp-link title="Home" url="/">Home</mp-link>
  </li>
  <li>
    <semantic-link title="Documentation" iri='[[resolvePrefix "rsp:Documentation"]]'>Documentation</semantic-link>
  </li>
  <li>
    <semantic-link title="Developer Documentation" iri="http://help.researchspace.org/resource/Start">Developer Documentation</semantic-link>
  </li>
 
  <li class="active">Client-side templating</li>
</ol>

<div class="page">
  <div class='page__body'>
    <h1>Client-side Templating Syntax and Helpers</h1>
    <p>
      Most of custom HTML5 components provided by the platform, support some way to customize the visualization of the component using client-side <a href='http://handlebarsjs.com/' target='_blank'>handlebars.js</a> template.
    </p>
    <p>
      Depending on the context in which the template is used it can have access to different helper functions and variables. 
      For example in <semantic-link iri='http://help.researchspace.org/resource/SemanticQuery' class="text-underline" target="_blank">semantic query</semantic-link>'s <code>template</code> has 
      access to the full SPARQL Select query result set, in 
      comparison to <semantic-link iri='http://help.researchspace.org/resource/SemanticTable' class="text-underline" target="_blank">semantic table</semantic-link>'s <code>tuple-template</code>, 
      which has access only to single result set tuple.
    </p>
    <p>
      But there are some properties of client-side templates that are independent from the context:
    </p>

    <ul>
      <li>
        we are using <code>{{ ... }}</code> delimiter in order to 
        distinguish from <semantic-link iri='http://help.researchspace.org/resource/BackendTemplating' class="text-underline" target="_blank">back-end 
          template</semantic-link> expressions (<code>[&#8203[&#8203 ... ]&#8203]</code>)
      </li>
      <li>
        all <a href='http://handlebarsjs.com/builtin_helpers.html' class="text-underline" target="_blank">built-in handlebars.js helpers</a> are available out of the box
      </li>
      <li>
        typically if template has access to SPARQL SELECT result bindings, binding value is accessible under <code>bindingName.value</code>. When the binding is a literal one can also access the literal's datatype as <code>bindingName.dataType.value</code>
      </li>
    </ul>

    <bs-alert bs-style='warning'>
      <rs-icon icon-type="rounded" icon-name="report_problem" symbol="true"></rs-icon> 
      The template MUST have a single HTML root element, the same rule also applies to includes!
    </bs-alert>
    <h3>Named template definitions</h3>
    <p>
      It is possible to define named templates by adding <code><template id='template-name'>...</template></code> as a child to a markup element.
      The template can be referenced from inline templates or another named template through Handlebars
      <a href='http://handlebarsjs.com/partials.html' class="text-underline" target="_blank"> partial call syntax</a>.
    </p>
    <bs-panel header='Example: named template' collapsible=true default-expanded=true>
      <mp-code-example show-code-by-default=true>
<![CDATA[
        <semantic-table query='SELECT * WHERE { VALUES(?object ?diameter) { ("Sun" 1391400) ("Moon" 3474) } }'
                        column-configuration='[
              {"variableName": "object", "displayName": "Planet"},
              {"displayName": "Diameter", "cellTemplate": "{{> planet-diameter}}"}
            ]'>
          <template id='planet-diameter'><span>{{diameter.value}}&nbsp;<i>km</i></span></template>
        </semantic-table>
]]>
      </mp-code-example>
    </bs-panel>
    <p>
      It is possible to nest named template definitions; parent bindings are automatically accessible in nested templates if not explicitly overriden.
    </p>
    <bs-panel header='Example: nested templates with access to the parent binding scope' collapsible=true default-expanded=true>
      <mp-code-example show-code-by-default=true>
<![CDATA[
        <semantic-query query='
           SELECT ?object ?latin ("(latin)" as ?suffix) WHERE {
             VALUES(?object ?latin) {
               ("sun" "sol")
               ("moon" "luna")
               ("star" "stella")
             }
           }' template='{{> list}}'>
          <template id='list'>
            <div>
              <b>Latin words for celestial objects:</b>
              <ul>
                {{#each bindings}}
                  {{> object}}
                {{/each}}
              </ul>
            </div>
          </template>
          <template id='object'>
            {{> words eng=object.value lat=latin.value}}
          </template>
          <template id='words'>
             <!-- both 'eng' and 'lat' parameters and 'suffix' binding are available here -->
             <li><i class="fa fa-star-o"></i>{{eng}} - {{lat}} {{suffix.value}}</li>
          </template>
        </semantic-query>
]]>
      </mp-code-example>
    </bs-panel>
    <p>
      Resource IRIs are supported as template names, e.g. <code>{{> some:resource}}</code>.
      These template references will be automatically resolved by fetching the template source from the corresponding resource page.
      It is also possible to override a remote template by defining a named template with the same IRI.
    </p>
    <bs-panel header="Example: named template with reference and override" collapsible=true default-expanded=true>
      <mp-code-block>
<![CDATA[
  <!-- :planet resource markup (http://www.researchspace.org/resource/planet) -->
  <li><i class="fa fa-globe"></i>{{name.value}}</li>

  <!-- Main markup -->

  <!-- using remote :planet template -->
  <semantic-query query='SELECT * WHERE { VALUES(?name) { ("Venus") ("Earth") ("Mars") } }'
                  template='<div>{{#each bindings}} {{> :planet}} {{/each}}</div>'></semantic-query>

  <!-- overriding remote template -->
  <semantic-query query='SELECT * WHERE { VALUES(?name) { ("Venus") ("Earth") ("Mars") } }'
                  template='<div>{{#each bindings}} {{> :planet}} {{/each}}</div>'>
    <template id='http://www.researchspace.org/resource/planet'>
      <li><b>{{name.value}};</b></li>
    </template>
  </semantic-query>
]]>
      </mp-code-block>
    </bs-panel>

   
  </div>
</div>
