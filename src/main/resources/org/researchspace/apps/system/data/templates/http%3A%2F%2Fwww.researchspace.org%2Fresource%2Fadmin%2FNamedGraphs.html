<ol class="page-breadcrumb">
  <li>
    <semantic-link-container uri="http://www.researchspace.org/resource/ThinkingFrames" 
                            urlqueryparam-view='admin'
                            urlqueryparam-resource-iri='[[resolvePrefix "rsp:admin"]]'
                            urlqueryparam-custom-label='Administration'>
      <div>Administration</div>
    </semantic-link-container>
  </li>
  <li>
    <semantic-link-container uri="http://www.researchspace.org/resource/ThinkingFrames" 
                            urlqueryparam-view='admin'
                            urlqueryparam-resource-iri='[[resolvePrefix "Admin:DataImportExport"]]'
                            urlqueryparam-custom-label='Data Import & Download'>
      <div>Data Import & Download</div>
    </semantic-link-container>
  </li>
  <li class="active">Named Graph: [[urlParam "graph"]]</li>
</ol>

<div class="page__grid-container application-page-container">
  <div class='page__content-container'>

    [[> rsp:adminPageHeader title="Named Graph"]]    
    <div><b>URI</b>: <i>[[urlParam "graph"]]</i></div>
    
    <bs-tabs id="named-graph-tabs" unmount-on-exit="true">
      <bs-tab event-key="1" title="Preview" unmount-on-exit="true">
        <h2>Statements</h2>
        <semantic-query
          query='
                SELECT (COUNT(DISTINCT *) as ?number) WHERE {
                    GRAPH <[[urlParam "graph"]]> { 
                      {SELECT * WHERE{ ?Subject ?Property ?Object}  LIMIT 1000 }
                    }
                } LIMIT 1
              '
          template="{{> statements}}"
        >
          <template id="statements">
            {{#each bindings}} {{#ifCond number.value ">=" 1000}}
            <bs-alert bs-style="warning">
              The table below is limited to show only a preview of <strong>1000 statements</strong> from the named
              graph. However, the absolute number of statements in the graph seems to be larger.
            </bs-alert>
            {{else}}
            <bs-alert bs-style="info">
              The named graphs contains <strong>{{number.value}}</strong> distinct statements.
            </bs-alert>
            {{/ifCond}} {{/each}}
          </template>
        </semantic-query>

        <semantic-table
          query='
                SELECT ?Subject ?Property ?Object WHERE{ 
                    GRAPH <[[urlParam "graph"]]> {
                      ?Subject ?Property ?Object
                    }
                } LIMIT 1000
              '
          options='{
                "resultsPerPage":10
              }'
        ></semantic-table>
      </bs-tab>
      <bs-tab event-key="2" title="Statistics" unmount-on-exit="true">
        <h2>Statement Statistics</h2>
        [[!-- to be listed in the includes [[>Admin:NamedGraphsStatistics]] --]]
        <semantic-query
          query='
                SELECT (COUNT(DISTINCT *) as ?number) WHERE { 
                    GRAPH <[[urlParam "graph"]]>{ 
                      {
                        SELECT * WHERE { 
                          ?Subject ?Property ?Object
                        } LIMIT 1000000
                      }
                    }
                } LIMIT 1'
          template="{{> statistics}}"
        >
          <template id="statistics">
            {{#each bindings}} {{#ifCond number.value ">=" 1000000}}
            <bs-alert bs-style="warning">
              Statics are only available for named graph with less than 1.000.000 statements. However, the absolute
              number of statements in the graph seems to be larger.
            </bs-alert>
            {{else}}
            <mp-page-loader
              iri="http://www.researchspace.org/resource/admin/NamedGraphsStatistics"
            ></mp-page-loader>
            {{/ifCond}} {{/each}}
          </template>
        </semantic-query>
      </bs-tab>
      <bs-tab event-key="3" title="Graph" unmount-on-exit="true">
        <semantic-query
          query='
                SELECT (COUNT(DISTINCT *) as ?number) WHERE {
                    GRAPH <[[urlParam "graph"]]> { 
                      {
                        SELECT * WHERE { ?Subject ?Property ?Object} LIMIT 100
                      }
                    }
                } LIMIT 1'
          template="{{> graph}}"
        >
          <template id="graph">
            {{#each bindings}} {{#ifCond number.value ">=" 100}}
            <bs-alert bs-style="warning">
              The table below is limited to show only a preview of <strong>100 statements</strong> from the named
              graph. However, the absolute number of statements in the graph seems to be larger and as such some
              edges or nodes might be missing.
            </bs-alert>
            {{else}} {{/ifCond}} {{/each}}
          </template>
        </semantic-query>
        <semantic-graph
          height="600px"
          query='
                  CONSTRUCT { ?Subject ?Property ?Object } WHERE {
                      GRAPH <[[urlParam "graph"]]> { ?Subject ?Property ?Object }
                  } LIMIT 100
                '
        >
          <semantic-graph-layout-cose-bilkent ideal-edge-length="50"></semantic-graph-layout-cose-bilkent>
          <semantic-graph-extension-panzoom pan-indicator-min-opacity="0.1"></semantic-graph-extension-panzoom>
        </semantic-graph>
      </bs-tab>
    </bs-tabs>
  </div>
</div>
